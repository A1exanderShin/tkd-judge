<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>TKD Judge – Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            margin-bottom: 10px;
        }
        button {
            margin: 4px;
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
        }
        .panel {
            margin-bottom: 15px;
            padding: 10px;
            background: #fff;
            border-radius: 6px;
        }
        .red { color: darkred; }
        .blue { color: darkblue; }
        pre {
            background: #111;
            color: #0f0;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>

<h1>TKD Judge – Demo UI</h1>

<div class="panel">
    <strong>State:</strong> <span id="state">—</span><br/>
    <strong>Timer:</strong> <span id="timer">—</span>
</div>

<div class="panel">
    <strong class="red">Red:</strong> <span id="redScore">0</span> |
    Warnings: <span id="redWarnings">0</span><br/>
    <strong class="blue">Blue:</strong> <span id="blueScore">0</span> |
    Warnings: <span id="blueWarnings">0</span>
</div>

<div class="panel">
    <h3>Fight control</h3>
    <button onclick="fight('start')">Start</button>
    <button onclick="fight('pause')">Pause</button>
    <button onclick="fight('resume')">Resume</button>
    <button onclick="fight('stop')">Stop</button>
    <button onclick="resetFight()">Reset</button>
</div>

<div class="panel">
    <h3>Judges</h3>
    <div>
        <strong class="red">Red</strong><br/>
        <button onclick="score(1, 'red', 1)">+1</button>
        <button onclick="score(1, 'red', 2)">+2</button>
        <button onclick="score(1, 'red', 3)">+3</button>
        <button onclick="warning('red')">Warning</button>
    </div>
    <div style="margin-top:10px;">
        <strong class="blue">Blue</strong><br/>
        <button onclick="score(1, 'blue', 1)">+1</button>
        <button onclick="score(1, 'blue', 2)">+2</button>
        <button onclick="score(1, 'blue', 3)">+3</button>
        <button onclick="warning('blue')">Warning</button>
    </div>
</div>

<div class="panel">
    <h3>Logs</h3>
    <pre id="log"></pre>
</div>

<script>
    const logEl = document.getElementById("log");

    function log(msg) {
        logEl.textContent += msg + "\n";
        logEl.scrollTop = logEl.scrollHeight;
    }

    const ws = new WebSocket("ws://localhost:8080/ws");

    ws.onopen = () => log("CONNECTED");

    ws.onmessage = e => {
        log("← " + e.data);
        const msg = JSON.parse(e.data);

        if (msg.type === "state") {
            document.getElementById("state").textContent = msg.state;
        }

        if (msg.type === "timer") {
            document.getElementById("timer").textContent = msg.seconds_left + " s";
        }

        if (msg.type === "score_update") {
            document.getElementById("redScore").textContent = msg.red;
            document.getElementById("blueScore").textContent = msg.blue;
        }

        if (msg.type === "warnings") {
            document.getElementById("redWarnings").textContent = msg.red;
            document.getElementById("blueWarnings").textContent = msg.blue;
        }
    };

    function fight(action) {
        ws.send(JSON.stringify({
            Type: "fight_control",
            Data: { Action: action }
        }));
        log("→ fight_control: " + action);
    }

    function resetFight() {
        ws.send(JSON.stringify({ Type: "reset" }));
        log("→ reset");
    }

    function score(judge, fighter, points) {
        ws.send(JSON.stringify({
            Type: "score",
            Data: {
                JudgeID: judge,
                Fighter: fighter,
                Points: points
            }
        }));
        log(`→ score ${fighter} +${points}`);
    }

    function warning(fighter) {
        ws.send(JSON.stringify({
            Type: "warning",
            Data: { Fighter: fighter }
        }));
        log("→ warning " + fighter);
    }
</script>

</body>
</html>
